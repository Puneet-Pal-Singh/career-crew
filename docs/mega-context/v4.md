You are absolutely right. The conversation has become incredibly long, and the risk of me losing critical context is high, which leads to the frustrating cycle of errors and corrections we've experienced.

Pivoting to a new chat with a comprehensive, single "Mega-Context Prompt" is the perfect, professional way to move forward. It will ensure the next instance (me, but fresh) has a complete and accurate understanding of the entire project from day one.

I will take the time to build this prompt meticulously. It will be detailed, structured, and contain everything we've discussed and built.

---

**Here is the "Mega-Context Prompt V4 (MVP Nearing Completion)" for your new chat:**

---
**--- START OF MEGA-CONTEXT PROMPT V4 ---**

Hello! I am continuing the development of a job portal project named `careerCrewConsulting.com`. This is a comprehensive context prompt intended to provide a complete "state of the project" snapshot for a new chat instance. We have completed the majority of the MVP's core functionality and are moving into final feature implementation and polishing.

This prompt contains: the original project vision (the "Big Prompt"), the journey and key strategic pivots made, a detailed breakdown of all features and UI implemented so far, the current file structure, an updated implementation plan, and the immediate next steps. Your role is to assist me in completing the MVP and preparing for deployment.

**I. ORIGINAL PROJECT OVERVIEW & "THE BIG PROMPT" SPECIFICATION (PRE-PIVOT)**

The initial goal was to build a job portal with a modern SaaS look (Vercel/Linear inspired), originally using a custom backend (Node.js, Prisma, PostgreSQL in Docker) and in-house JWT authentication. This section is crucial for understanding the foundational feature requirements and the project's origins.

---
**[[[ USER: PLEASE PASTE YOUR COMPLETE ORIGINAL "BIG PROMPT" V2 SPECIFICATION HERE ]]]**
*(This is the detailed prompt that included the full PRD, original tech stack, UI/UX flows, and the initial Vercel-inspired design guidelines. It's the one we previously assembled for this purpose.)*
---
[END OF ORIGINAL "BIG PROMPT" SPECIFICATION]
---

**II. PROJECT JOURNEY & KEY PIVOTS**

1.  **Initial Phase (Docker, Prisma, Custom Auth):** We began by setting up the project with a Dockerized environment, using Prisma and a custom JWT solution. We made significant progress on the landing page UI.
2.  **PIVOT 1: To Supabase for Backend:** We encountered significant development friction with Docker and Prisma configurations. To accelerate MVP development, we made a strategic pivot to use **Supabase** for our backend services (Authentication, Database). This allowed us to focus on building user-facing features rapidly. All custom backend code was removed.
3.  **PIVOT 2: UI/UX Refinement:** Inspired by modern job portals like Wellfound and professional B2B SaaS dashboards, we've refined our UI direction. The focus is on clean, data-rich, and intuitive layouts with a professional and engaging aesthetic.
4.  **PIVOT 3: Persistent Role Selection:** We moved from a temporary `sessionStorage` solution to a persistent, database-driven flag (`has_made_role_choice`) to handle the user's one-time role selection, providing a much better user experience.
5.  **PIVOT 4: Context-Aware Layouts:** We implemented a robust layout system that distinguishes between public-facing pages (which have a global, sticky header) and internal dashboard pages (which have their own integrated layout with a sidebar and non-sticky header).

**III. CURRENT STATE: ACHIEVEMENTS & FILE STRUCTURE (AS OF MAY 2025)**

The core functionality for all three user roles (Seeker, Employer, Admin) is largely complete for the MVP.

**A. Current Tech Stack:**

*   **Framework:** Next.js (v15+, App Router) with TypeScript.
*   **BaaS:** Supabase (Auth, PostgreSQL Database).
*   **Styling:** Tailwind CSS.
*   **UI Components:** `shadcn/ui` (Button, Card, Input, Select, Checkbox, Table, Dialog, Alert, Toast, Dropdown Menu, Avatar, Sheet, Skeleton, etc.).
*   **State Management:** React Context API (`AuthContext`, `UserProfileContext`), `useState`, `useEffect`.
*   **Forms:** `react-hook-form` with `zod` for validation.
*   **Animations:** `framer-motion` (primarily on landing page).
*   **Deployment Target:** Vercel.

**B. Key Features & Pages COMPLETED:**

*   **Core Authentication & Layout:**
    *   Full user authentication (Sign Up, Login, Logout) using Supabase Auth.
    *   Persistent, one-time role selection (`JOB_SEEKER` / `EMPLOYER`) for new users.
    *   A robust, context-aware layout system with a separate global header for public pages and an integrated layout (sidebar + header) for all `/dashboard` routes.
*   **Landing Page (`/`):**
    *   A multi-section, visually rich landing page with animations is complete (though data for "Recent Jobs" is now live).
*   **Public Job Seeker Flow (Option A & B):**
    *   **`/jobs` (Job Listing Page):** A modern, two-column layout featuring:
        *   A prominent `JobSearchHero` component for keyword and location search.
        *   A `JobFilterSidebar` with collapsible sections and checkbox-based filters for Job Type and Location, and a toggle for "Remote Only".
        *   A row-based `JobListItem` component for displaying jobs.
        *   Functional server-side filtering, searching, and pagination via `getPublishedJobs` server action.
    *   **`/jobs/[jobId]` (Job Detail Page):**
        *   Dynamic page that fetches and displays full details for a single `APPROVED` job.
        *   Handles 404s for non-existent or non-approved jobs.
        *   Has dynamic metadata for SEO.
        *   Features an "Apply Now" button.
*   **Authenticated Job Seeker Flow (Option C):**
    *   **Job Application:**
        *   A fully functional `ApplicationModal` using `shadcn/ui Dialog` and `react-hook-form`.
        *   Pre-fills user data (name, email) if logged in.
        *   Calls a `submitApplication` server action that validates the request and saves the application to the database.
        *   Prevents duplicate applications.
        *   Redirects logged-out users to login before applying.
    *   **Seeker Dashboard (`/dashboard` for Seeker):**
        *   Renders a professional, data-rich overview.
        *   Includes reusable `StatCard` components to show "Total Applications" and "Active Applications" fetched via a server action.
        *   Includes a `ProfileSummaryCard` for user context.
        *   Features a preview of recent applications.
    *   **My Applications Page (`/dashboard/seeker/applications`):**
        *   A dedicated page showing a full table (`MyApplicationsTable`) of all jobs the seeker has applied to, including job title, company, date, and application status.
        *   Fetches data via `getMyApplicationsAction` which correctly joins `applications` and `jobs` tables.
*   **Employer Flow:**
    *   **Employer Dashboard (`/dashboard` for Employer):**
        *   Renders a professional overview with clear links to "Post a New Job" and "My Job Listings".
    *   **Post/Edit Job Flow:**
        *   A reusable `JobEditorForm.tsx` (decomposed into fieldset sub-components) handles both creating and editing jobs.
        *   `/dashboard/post-job` uses the form in "create" mode.
        *   `/dashboard/my-jobs/[jobId]/edit` uses the form in "edit" mode, pre-filled with existing job data.
        *   Server actions `createJobPost` and `updateJobPost` handle saving data to Supabase. Editing an approved job correctly resets its status to `PENDING_APPROVAL`.
    *   **My Job Postings Page (`/dashboard/my-jobs`):**
        *   Displays all jobs posted by the employer in a clean `EmployerJobTable`.
        *   Shows job status (`APPROVED`, `REJECTED`, etc.) with colored badges.
        *   Provides working "View" (for approved jobs) and "Edit" links. "Archive" button is a placeholder.
*   **Admin Flow (Option D):**
    *   **Admin User:** Manual setup of an admin user is complete.
    *   **Admin Dashboard (`/dashboard` for Admin):** Renders a basic overview with a link to the pending approvals page.
    *   **Pending Job Approvals Page (`/dashboard/admin/pending-approvals`):**
        *   Displays a table of all jobs with `status: 'PENDING_APPROVAL'`.
        *   Provides functional "Approve" and "Reject" buttons that call server actions (`approveJob`, `rejectJob`).
        *   Uses toast notifications for feedback.
        *   Protected by RLS policies.
*   **Code Architecture:**
    *   Server actions have been refactored into a clean, domain-specific file structure (`/actions/query`, `/actions/employer`, etc.).
    *   Shared utilities (`getSupabaseServerClient`) and data mappers (`jobDataMappers`) have been created.

**C. Current File Structure Snapshot:**
*You have a very well-organized file structure with over 130 files. It would be too long to paste here. We'll assume the structure you last provided is the current state.*

---

**IV. UPDATED & DETAILED IMPLEMENTATION PLAN (MARKDOWN)**

This plan reflects what is done and what remains for the MVP and beyond.

```markdown
# Career Crew - Implementation Plan (Post-Core MVP)

**Goal:** Polish the MVP, perform rigorous testing, and prepare for initial deployment.

---

### Phase 0 & 1: Foundation & Supabase Pivot (DONE)
*   [x] Project Initialization, Version Control, Code Quality Setup.
*   [x] Strategic Pivot from Docker/Prisma to Supabase for BaaS.
*   [x] Comprehensive Project Cleanup of old backend code.
*   [x] Full Supabase Authentication and Middleware implementation.
*   [x] Persistent, Database-driven User Role Selection.
*   [x] Context-Aware Layout System (Public Header vs. Dashboard Layout).
*   [x] Full Landing Page UI implementation.

### Phase 2: Core MVP Feature Implementation (95% DONE)
*   [x] **Supabase Database & RLS:**
    *   [x] All core tables (`profiles`, `jobs`, `applications`) created with defaults and relationships.
    *   [x] DB Trigger for automatic profile creation on user signup.
    *   [x] Initial RLS policies for all tables and roles implemented.
*   [x] **Employer Flow:**
    *   [x] Post New Job (Form, Server Action).
    *   [x] View "My Job Listings" (Page, Table, Server Action).
    *   [x] Edit Job (Page, Form pre-fill, Server Action).
    *   [ ] **Archive Job Functionality:** Implement `archiveJob` action and confirmation modal.
*   [x] **Job Seeker Flow:**
    *   [x] Public Job Listing Page (`/jobs`) with search, filters, and pagination.
    *   [x] Public Job Detail Page (`/jobs/[jobId]`).
    *   [x] Job Application via Modal (Form, Server Action, Auth check).
    *   [x] Seeker Dashboard Overview with Stat Cards and recent application preview.
    *   [x] "My Applications" Page (`/dashboard/seeker/applications`) with a full table of submitted applications.
*   [x] **Admin Flow:**
    *   [x] Admin user manually configured.
    *   [x] Pending Job Approvals page with table display.
    *   [x] Functional "Approve" and "Reject" actions.

### Phase 3: MVP Polish & Deployment (IN PROGRESS / NEXT STEPS)
*   [ ] **Complete Final MVP Features:**
    *   [ ] **Employer Flow:** Implement "Archive Job" functionality with a confirmation dialog.
    *   [ ] **Dashboard Polish:** Implement stats actions (`getEmployerDashboardStats`, `getAdminDashboardStats`) to make the Employer and Admin overview pages data-rich like the Seeker's.
*   [ ] **Thorough End-to-End Testing:**
    *   [ ] Test all user flows with dedicated test accounts for each role.
    *   [ ] Test edge cases (e.g., applying to a job that gets archived, editing a rejected job).
*   [ ] **Row Level Security (RLS) - Final Audit:**
    *   [ ] Rigorously test all RLS policies to ensure no data leaks or unauthorized actions are possible. Create a testing matrix for this.
*   [ ] **UI/UX Polish:**
    *   [ ] **Loading States:** Implement skeleton loaders for tables (`EmployerJobTable`, `MyApplicationsTable`, etc.) for a better loading experience.
    *   [ ] **Empty States:** Review and enhance all empty-state messages to be more helpful.
    *   [ ] **Responsiveness:** Conduct a full review of all pages on mobile and tablet screen sizes.
    *   [ ] **Accessibility (A11y) Check:** Basic keyboard navigation, focus states, ARIA labels.
*   [ ] **Deployment:**
    *   [ ] Configure Production Environment Variables in Vercel.
    *   [ ] Review Supabase project settings for production (e.g., enable email confirmations).
    *   [ ] Deploy main branch to Vercel.
    *   [ ] Post-deployment smoke testing.

### Phase 4: Post-MVP / V2 Enhancements (Future)
*   [ ] **Saved Jobs:** Implement bookmarking functionality for seekers.
*   [ ] **Employer Dashboard V2:** Add analytics, charts, and ability to view applicants for each job.
*   [ ] **Advanced Search:** Implement full-text search and more advanced filters (salary range, experience level - requires DB schema changes).
*   [ ] **Profile Management:** Create "Settings" pages for users to update their profile details (name, avatar upload).
*   [ ] **Email Notifications:** Integrate Supabase or a third-party service (e.g., Resend) for key notifications (new applicant, application status change, etc.).
*   [ ] **Original "Big Prompt" Features:** Re-evaluate advanced features like on-platform resume builder, AI matching, etc.
---
```

**V. IMMEDIATE NEXT STEPS FOR NEW CHAT**

**The primary goal for this new chat session is to complete the final MVP features and begin the polishing phase.**

1.  **Implement "Archive Job" for Employers:**
    *   Create the `archiveJobAction.ts` file.
    *   Create a reusable `ConfirmationDialog.tsx` component using `shadcn/ui AlertDialog`.
    *   Integrate this into the `EmployerJobTable.tsx` to make the "Archive" button functional.
2.  **Enhance Employer and Admin Dashboards:**
    *   Create the server actions (`getEmployerDashboardStats`, `getAdminDashboardStats`) to fetch data for their respective overview stat cards.
    *   Update `EmployerDashboardView.tsx` and `AdminDashboardView.tsx` to call these actions and display the live stats.
3.  **Begin UI Polish:**
    *   Start by implementing skeleton loaders for the main data tables to replace the simple spinners.

Your first request in the new chat should be: **"Let's implement the 'Archive Job' functionality for the employer dashboard."**

---
**--- END OF MEGA-CONTEXT PROMPT V4 ---**