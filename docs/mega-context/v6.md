Of course. This is the perfect time to consolidate our progress. The journey has been complex, with significant architectural pivots and a final, successful push to a stable `main` branch. Creating a new, comprehensive context prompt is the best way to ensure the next phase of development is smooth, efficient, and built on a solid foundation of understanding.

I will now generate the complete **"Mega-Context Prompt V6."** This document is designed to be a full "brain dump" of the project. It contains everything we have discussed, built, and fixed.

You can copy and paste the entire content into a new chat to bring the new AI instance completely up to speed.

---
**--- START OF MEGA-CONTEXT PROMPT V6 (MVP COMPLETION) ---**

Hello! I am continuing the development of a job portal project named `careerCrew.com`. This is a comprehensive context prompt intended to provide a complete "state of the project" snapshot for a new chat instance. We have completed a major series of architectural refactors and bug fixes, resulting in a stable, professional, and performant `main` branch. We are now ready to implement the final features for our Minimum Viable Product (MVP) and deploy to production.

This prompt contains: the original project vision (the "Big Prompt"), a detailed project journey highlighting key strategic pivots, a breakdown of all features and UI implemented so far (including the latest routing and database schema), an updated implementation plan, and the immediate next steps. Your role is to assist me in completing these final MVP features and preparing for our first production deployment.

**I. ORIGINAL PROJECT OVERVIEW & "THE BIG PROMPT" SPECIFICATION (PRE-PIVOT)**

The initial goal was to build a job portal with a modern SaaS look (Vercel/Linear inspired), originally using a custom backend (Node.js, Prisma, PostgreSQL in Docker) and in-house JWT authentication. This section is crucial for understanding the foundational feature requirements and the project's origins.

---
**[[[ USER: PLEASE PASTE YOUR COMPLETE ORIGINAL "BIG PROMPT" V2 SPECIFICATION HERE ]]]**
*(This is the detailed prompt that included the full PRD, original tech stack, UI/UX flows, and the initial Vercel-inspired design guidelines. It's the one we previously assembled for this purpose.)*
---
[END OF ORIGINAL "BIG PROMPT" SPECIFICATION]
---

**II. PROJECT JOURNEY & KEY PIVOTS**

This project has undergone several critical architectural pivots to increase development velocity and improve the end-product. Understanding this journey is key to understanding the current state.

1.  **PIVOT 1: To Supabase for Backend:** We encountered significant development friction with a Dockerized Node.js/Prisma backend. We made a strategic pivot to use **Supabase** for our backend services (Authentication, PostgreSQL Database). A database trigger (`handle_new_user`) was implemented to automatically create a `profiles` row when a new user signs up.

2.  **PIVOT 2: The "Server-First" State Management Architecture:** We encountered significant performance issues (slow loads, "flash of incorrect content") due to client-side state management. We refactored the entire application layout to a "server-first" architecture where the root layout (`/app/layout.tsx`) fetches the user's session **on the server** and passes it down as props. This eliminated all client-side race conditions.

3.  **PIVOT 3: The "Wellfound Model" for Authentication & Routing:** Our initial auth flow was confusing. We executed a major refactor to a more professional and scalable model inspired by platforms like Wellfound:
    *   **Universal Login:** A single, clean login page at `/login`.
    *   **Contextual & Segregated Registration:** Separate, intuitive sign-up pages for Job Seekers (`/jobs/signup`) and Employers (`/employer/signup`). This replaced the old `/signup/*` structure.

4.  **PIVOT 4: Performance Optimization with JWT Metadata:** The middleware was making a database call on every authenticated request to check a user's onboarding status, creating a major performance bottleneck. We refactored this to:
    *   Store the `role` and `onboarding_complete` status directly in the user's JWT `app_metadata`.
    *   The `handle_new_user` trigger and `updateOnboardingAction` now write this metadata to `auth.users`.
    *   The middleware now reads this data directly from the user's token, making it instantaneous and removing all database calls.

5.  **PIVOT 5: The "Wellfound Model" for Job IDs (Numeric IDs & Slugs):** We migrated the primary key for the `jobs` table from `UUID` to a large, auto-incrementing `BIGINT` (numeric ID), starting from `1000000`.
    *   This allows for professional, readable, and SEO-friendly URLs like `/jobs/1000001-senior-software-engineer`, perfectly emulating the Wellfound model.
    *   The entire application (types, server actions, data mappers, UI components) was refactored to support this new numeric ID schema.

**III. CURRENT STATE: ACHIEVEMENTS & FILE STRUCTURE (AS OF JULY 2025)**

The application's architecture is now considered **SOLID**. The core functionality for all user roles is stable, performant, secure, and feature-complete for the MVP foundation.

**A. Current Tech Stack:**

*   **Framework:** Next.js (v15+, App Router) with TypeScript.
*   **BaaS:** Supabase (Auth, PostgreSQL Database with RLS).
*   **Styling:** Tailwind CSS.
*   **UI Components:** `shadcn/ui` and Origin UI.
*   **State Management:** Primarily server-side props.
*   **Forms:** `react-hook-form` with `zod`.
*   **Deployment:** Vercel with a fully configured CI/CD pipeline and protected `main` branch.

**B. Key Features & Pages COMPLETED:**

*   **Production-Grade Authentication:** Full Email/Password and Google OAuth flows with the robust "Wellfound Model" routing (`/login`, `/jobs/signup`, `/employer/signup`).
*   **Mandatory Onboarding Flow:** A fully functional and secure onboarding process that correctly sets the user's role and profile information.
*   **Performant Layout System:** A "server-first" layout that passes the user session from the server, with a performant middleware that reads from the JWT, eliminating any UI flashing.
*   **Professional Routing & Slugs:** All routes now follow the clean, contextual "Wellfound Model". Job detail pages use numeric IDs and SEO-friendly slugs (e.g., `/jobs/1000001-senior-engineer`).
*   **"Redirect Back" Functionality:** The application now correctly remembers a user's intended destination (e.g., a specific job page) through the entire login, sign-up, and onboarding process.
*   **Database & Security:** The database schema is finalized with numeric job IDs. RLS policies are in place, and the `handle_new_user` trigger is hardened and robust.
*   **Core User Flows (All Verified):**
    *   **Employer:** Can sign up, post a job, and view their jobs.
    *   **Admin:** Can log in, see a list of pending jobs, and approve them.
    *   **Public/Seeker:** Can view approved jobs on the `/jobs` page, click through to a correct slug-based URL, and apply for a job.
    *   **Seeker:** Can sign up, apply for a job, and view their applications in their dashboard.

**C. Current File Structure Snapshot:**
*The file structure is well-organized around the App Router paradigm, with clear separation for server actions (`src/app/actions`), components (`src/components`), and library/utility code (`src/lib`). It contains ~170 files.*

---

**IV. UPDATED & DETAILED IMPLEMENTATION PLAN (MARKDOWN)**

This plan reflects what is done and what remains for the MVP and beyond.

```markdown
# Career Crew - Implementation Plan (Post-Refactor)

**Goal:** Complete the final user-facing features of the MVP, perform a final polish and testing pass, and deploy to production.

---

### Phase 1 & 2: Foundation & Core Architecture (100% DONE)
*   [x] Project Initialization & Setup.
*   [x] Strategic Pivot from Docker/Prisma to Supabase for BaaS.
*   [x] **Complete Auth Overhaul (The "Wellfound Model"):**
    *   [x] Implement contextual signup pages (`/jobs/signup`, `/employer/signup`).
    *   [x] Implement a universal login page (`/login`).
    *   [x] Implement fully functional Email/Password and Google OAuth flows.
    *   [x] Create a robust database trigger (`handle_new_user`).
*   [x] **Complete Layout & State Overhaul ("Server-First" & JWT Metadata):**
    *   [x] Refactor root layout to fetch user session on the server.
    *   [x] Optimize middleware to read `role` and `onboarding_complete` from JWT, eliminating DB calls.
*   [x] **Complete Routing & Database Migration (Numeric IDs & Slugs):**
    *   [x] Migrate `jobs.id` from UUID to auto-incrementing BIGINT.
    *   [x] Refactor the entire application (types, actions, UI) to use numeric job IDs.
    *   [x] Implement SEO-friendly slugs for job detail pages (`/jobs/1000001-job-title`).
*   [x] **Implement "Redirect Back" Functionality:**
    *   [x] The application now correctly preserves the user's intended destination through the entire auth and onboarding flow.
*   [x] **Core User Flows Implemented & Tested:**
    *   [x] Employer: Post, View jobs.
    *   [x] Admin: Approve jobs.
    *   [x] Seeker: Apply, View applications.

### Phase 3: MVP Feature Completion & Polish (IN PROGRESS / NEXT STEPS)
*   [ ] **Complete Final MVP Features:**
    *   [ ] **Employer Flow: Archive Job Functionality:** This is the highest priority feature.
        *   [ ] Create an `archiveJob` server action to set a job's status to `ARCHIVED`.
        *   [ ] Add an "Archive" button to the `EmployerJobTable`.
        *   [ ] This button should trigger a confirmation dialog before calling the action.
    *   [ ] **Dashboard Polish: Add Stats for Employer & Admin:**
        *   [ ] Create `getEmployerDashboardStats` and `getAdminDashboardStats` server actions.
        *   [ ] Integrate these actions into the respective dashboard views to display stats.
*   [ ] **Final Polish & Testing:**
    *   [ ] **UI/UX: Implement Loading States:**
        *   [ ] Add skeleton loaders for tables and card grids for a better loading experience.
    *   [ ] **UI/UX: Implement Empty States:**
        *   [ ] Review all pages that display lists of data to ensure there are helpful and well-designed "empty state" messages.
    *   [ ] **Critical Security: Final RLS Audit:**
        *   [ ] Perform one last, critical review of all Supabase RLS policies.
*   [ ] **Deployment:**
    *   [ ] The application has been successfully deployed, but this marks the official "MVP is ready" launch.

### Phase 4: Post-MVP / V2 Enhancements (Future)
*   [ ] **Saved Jobs / Bookmarking for Seekers.**
*   [ ] **Employer Dashboard V2: Applicant Viewing & Management.**
*   [ ] **Full Company Profiles.**
*   [ ] **Advanced Search & Filtering.**
*   [ ] **User Profile Management / Settings Page.**
*   [ ] **Email Notifications.**
*   [ ] **Job Aggregation / Scraping Engine.**
---
```

**V. IMMEDIATE NEXT STEPS FOR THE NEW CHAT**

**The primary goal for this new chat session is to complete the final user-facing features of the MVP.** The architectural foundation is now SOLID and STABLE.

1.  **Implement "Archive Job" for Employers:** This is the highest priority remaining feature for the MVP.
2.  **Add Statistics to the Employer and Admin Dashboards:** This will complete the dashboard experience.
3.  **Begin the final UI/UX Polish:** Focus on loading and empty states.

Your first request in the new chat should be: **"Let's implement the 'Archive Job' functionality for the employer dashboard."**

---
**--- END OF MEGA-CONTEXT PROMPT V6 ---**